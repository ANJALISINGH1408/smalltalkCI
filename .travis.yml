language: smalltalk
sudo: false

baseline: SWTDemo

env:
  global:
    - BASELINE_GROUP="TravisCI"
    - PACKAGES="packages"

install:
  - unset SMALLTALK_CI_HOME && source env_vars # make sure to use smalltalkCI from this branch
  - wget -q -O fixtures.zip https://github.com/hpi-swa/smalltalkCI/archive/fixtures.zip
  - unzip -q fixtures.zip
  - export PROJECT_HOME="$(pwd)/smalltalkCI-fixtures"

matrix:
  include:
    - language: generic
      script:
        - bash tests/run_tests.sh
        - bash tests/helpers_tests.sh
        - bash tests/pharo_tests.sh
        - bash tests/squeak_tests.sh

    - smalltalk: Squeak-trunk
      os: linux
    - smalltalk: Squeak-trunk
      os: osx
    - smalltalk: Squeak-5.0
      os: linux
    - smalltalk: Squeak-5.0
      os: osx
    - smalltalk: Squeak-4.6
      os: linux
    - smalltalk: Squeak-4.6
      os: osx
    - smalltalk: Squeak-4.5
      os: linux
    - smalltalk: Squeak-4.5
      os: osx
    - smalltalk: Pharo-alpha
      os: linux
    - smalltalk: Pharo-alpha
      os: osx
    - smalltalk: Pharo-stable
      os: linux
    - smalltalk: Pharo-stable
      os: osx
    - smalltalk: Pharo-5.0
      os: linux
    - smalltalk: Pharo-5.0
      os: osx
    - smalltalk: Pharo-4.0
      os: linux
    - smalltalk: Pharo-4.0
      os: osx
    - smalltalk: Pharo-3.0
      os: linux
    - smalltalk: Pharo-3.0
      os: osx

    - smalltalk: Squeak-4.4
      os: linux
      sudo: required
      group: legacy
      env: BUILDERCI=true
    # - smalltalk: Squeak-4.3
    #   os: linux
    #   sudo: required
    #   group: legacy
    #   env: BUILDERCI=true

    - smalltalk: Pharo-2.0
      os: linux
      sudo: required
      group: legacy
      env: BUILDERCI=true
    # - smalltalk: Pharo-1.4
    #   os: linux
    #   sudo: required
    #   group: legacy
    #   env: BUILDERCI=true
    # - smalltalk: PharoCore-1.2
    #   os: linux
    #   sudo: required
    #   group: legacy
    #   env: BUILDERCI=true
    # - smalltalk: PharoCore-1.1
    #   os: linux
    #   sudo: required
    #   group: legacy
    #   env: BUILDERCI=true

    - smalltalk: GemStone-3.2.7
      os: linux
      sudo: required
      group: legacy
    # - smalltalk: GemStone-3.2.0
    #   os: linux
    #   sudo: required
    #   group: legacy
    # - smalltalk: GemStone-3.1.0.6
    #   os: linux
    #   sudo: required
    #   group: legacy
    # - smalltalk: GemStone-3.1.0.2
    #   os: linux
    #   sudo: required
    #   group: legacy
    # - smalltalk: GemStone-3.0.1
    #   os: linux
    #   sudo: required
    #   group: legacy
    # - smalltalk: GemStone-2.4.6
    #   os: linux
    #   sudo: required
    #   group: legacy
    # - smalltalk: GemStone-2.4.5
    #   os: linux
    #   sudo: required
    #   group: legacy
    # - smalltalk: GemStone-2.4.4.1
    #   os: linux
    #   sudo: required
    #   group: legacy
  allow_failures:
    - smalltalk: Squeak-4.4
    - smalltalk: Squeak-4.3

    - smalltalk: Pharo-2.0
    - smalltalk: Pharo-1.4
    - smalltalk: PharoCore-1.2
    - smalltalk: PharoCore-1.1

    - smalltalk: GemStone-3.2.7
    - smalltalk: GemStone-3.2.0
    - smalltalk: GemStone-3.1.0.6
    - smalltalk: GemStone-3.1.0.2
    - smalltalk: GemStone-3.0.1
    - smalltalk: GemStone-2.4.6
    - smalltalk: GemStone-2.4.5
    - smalltalk: GemStone-2.4.4.1
  fast_finish: true

branches:
  except:
    - fixtures
